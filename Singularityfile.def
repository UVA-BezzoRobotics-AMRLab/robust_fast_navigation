Bootstrap: docker
From: ros:melodic

%setup
    mkdir -p ${SINGULARITY_ROOTFS}/jackal_ws/src

%files
    ./scripts/ipopt_install.sh /
    . /jackal_ws/src/robust_fast_navigation
%post -c /bin/bash
    apt -y update; apt-get -y install python3-venv
    python3 -m venv /venv
    export PATH="/venv/bin:$PATH"
    pip3 install --upgrade pip
    pip3 install defusedxml rospkg netifaces numpy

    apt -y install cppad gfortran wget liblapack*
    chmod +x ipopt_install.sh
    ./ipopt_install.sh

    cd /jackal_ws/src
    git clone https://github.com/jackal/jackal.git --branch melodic-devel
    git clone https://github.com/jackal/jackal_simulator.git --branch melodic-devel
    git clone https://github.com/jackal/jackal_desktop.git --branch melodic-devel
    git clone https://github.com/utexas-bwi/eband_local_planner.git
    git clone https://github.com/nocholasrift/mpc_trajectory_tracking.git
    git clone https://github.com/sikang/DecompUtil.git
    git clone https://github.com/Daffan/nav-competition-icra2022
    mv nav-competition-icra2022/jackal_helper .
    rm -rf nav-competition-icra2022

    source /opt/ros/melodic/setup.bash
    cd ..
    rosdep init; rosdep update
    rosdep install -y --from-paths . --ignore-src --rosdistro=melodic
    source devel/setup.bash
    catkin_make_isolated

%environment
    export PATH="/venv/bin:$PATH"
